<!-- Generated by SpecStory -->

# å¦‚ä½•å°†é¡¹ç›®éƒ¨ç½²åˆ°äº‘æœåŠ¡å™¨ (2025-06-12 11:26:46)

_**User**_

å¦‚ä½•å°†è¿™ä¸ªé¡¹ç›®éƒ¨ç½²åˆ°äº‘æœåŠ¡å™¨ï¼Ÿ

---

_**Assistant**_

æˆ‘éœ€è¦äº†è§£é¡¹ç›®çš„ç»“æ„å’ŒæŠ€æœ¯æ ˆï¼Œä»¥ä¾¿æä¾›å‡†ç¡®çš„äº‘æœåŠ¡å™¨éƒ¨ç½²æ–¹æ¡ˆã€‚

---

<details>
            <summary>Listed current directory â€¢ **19** results</summary>
        
| Name |
|-------|
| ğŸ“ `.git` |
| ğŸ“ `target` |
| ğŸ“„ `API_DOCUMENT.md` |
| ğŸ“„ `README.md` |
| ğŸ“ `uploads` |
| ğŸ“„ `TRAVEL_RECOMMENDATION_SUMMARY.md` |
| ğŸ“ `.specstory` |
| ğŸ“„ `.cursorindexingignore` |
| ğŸ“„ `bash.exe.stackdump` |
| ğŸ“„ `pom.xml` |
| ğŸ“„ `LICENSE` |
| ğŸ“„ `.gitignore` |
| ğŸ“ `.vscode` |
| ğŸ“„ `.gitattributes` |
| ğŸ“„ `HELP.md` |
| ğŸ“„ `mvnw.cmd` |
| ğŸ“ `.mvn` |
| ğŸ“„ `mvnw` |
| ğŸ“ `src` |

</details>

---

çœ‹èµ·æ¥è¿™æ˜¯ä¸€ä¸ªåŸºäºMavençš„Spring Booté¡¹ç›®ã€‚æˆ‘å°†æŸ¥çœ‹ä¸€ä¸‹pom.xmlæ–‡ä»¶æ¥ç¡®è®¤é¡¹ç›®ä¾èµ–ï¼Œç„¶åæ£€æŸ¥READMEå’Œsrcç›®å½•ä»¥äº†è§£æ›´å¤šé¡¹ç›®ç»†èŠ‚ã€‚

---

Read file: pom.xml

---

Read file: README.md

---

<details>
            <summary>Listed directory src/main/resources â€¢ **4** results</summary>
        
| Name |
|-------|
| ğŸ“ `static` |
| ğŸ“„ `application.properties` |
| ğŸ“„ `db-init.sql` |
| ğŸ“ `templates` |

</details>

---

Read file: src/main/resources/application.properties

---

Read file: API_DOCUMENT.md

---

åŸºäºä»¥ä¸Šä¿¡æ¯ï¼Œç°åœ¨æˆ‘æ¸…æ¥šäº†è¿™æ˜¯ä¸€ä¸ªSpring Bootæ—…è¡Œæ—¥è®°åˆ†äº«å¹³å°é¡¹ç›®ã€‚ä¸‹é¢æˆ‘å°†æä¾›å°†æ­¤é¡¹ç›®éƒ¨ç½²åˆ°äº‘æœåŠ¡å™¨çš„è¯¦ç»†æ­¥éª¤ï¼š

# å°†æ—…è¡Œæ—¥è®°ç³»ç»Ÿéƒ¨ç½²åˆ°äº‘æœåŠ¡å™¨

## 1. å‡†å¤‡å·¥ä½œ

### äº‘æœåŠ¡å™¨å‡†å¤‡
1. è´­ä¹°ä¸€å°äº‘æœåŠ¡å™¨ï¼ˆé˜¿é‡Œäº‘ã€è…¾è®¯äº‘ã€åä¸ºäº‘ç­‰ï¼‰
2. é…ç½®è¦æ±‚ï¼š
   - è‡³å°‘2æ ¸4Gå†…å­˜
   - æ“ä½œç³»ç»Ÿï¼šCentOS 7æˆ–Ubuntu 20.04ï¼ˆæ¨èï¼‰
   - å¼€æ”¾ç«¯å£ï¼š8081ï¼ˆåº”ç”¨ç«¯å£ï¼‰ã€3306ï¼ˆMySQLç«¯å£ï¼Œå»ºè®®åªå†…ç½‘è®¿é—®ï¼‰

### åŸŸåå‡†å¤‡ï¼ˆå¯é€‰ï¼‰
1. è´­ä¹°åŸŸåå¹¶å®Œæˆå®åè®¤è¯
2. å°†åŸŸåè§£æåˆ°äº‘æœåŠ¡å™¨IP

## 2. æœåŠ¡å™¨ç¯å¢ƒé…ç½®

### å®‰è£…JDK 17
```bash
# Ubuntuç³»ç»Ÿ
sudo apt update
sudo apt install openjdk-17-jdk -y

# CentOSç³»ç»Ÿ
sudo yum install -y java-17-openjdk-devel

# éªŒè¯JDKå®‰è£…
java -version
```

### å®‰è£…MySQL 8.0
```bash
# Ubuntuç³»ç»Ÿ
sudo apt update
sudo apt install mysql-server-8.0 -y

# CentOSç³»ç»Ÿ
sudo yum install -y https://dev.mysql.com/get/mysql80-community-release-el7-3.noarch.rpm
sudo yum install -y mysql-community-server

# å¯åŠ¨MySQLæœåŠ¡
sudo systemctl start mysqld
sudo systemctl enable mysqld

# è·å–MySQLåˆå§‹å¯†ç ï¼ˆCentOSï¼‰
sudo grep 'temporary password' /var/log/mysqld.log

# è®¾ç½®MySQLå¯†ç å’Œå®‰å…¨é…ç½®
sudo mysql_secure_installation
```

### é…ç½®MySQLæ•°æ®åº“
```bash
# ç™»å½•MySQL
mysql -u root -p

# åˆ›å»ºæ•°æ®åº“å’Œç”¨æˆ·
CREATE DATABASE traveldiary;
CREATE USER 'traveluser'@'localhost' IDENTIFIED BY 'password123';
GRANT ALL PRIVILEGES ON traveldiary.* TO 'traveluser'@'localhost';
FLUSH PRIVILEGES;
EXIT;
```

## 3. é¡¹ç›®æ‰“åŒ…å’Œä¸Šä¼ 

### æœ¬åœ°æ‰“åŒ…
```bash
# åœ¨é¡¹ç›®æ ¹ç›®å½•æ‰§è¡Œæ‰“åŒ…å‘½ä»¤
mvn clean package -DskipTests
```

### ä¸Šä¼ åˆ°æœåŠ¡å™¨
```bash
# ä½¿ç”¨SCPæˆ–SFTPä¸Šä¼ æ‰“åŒ…å¥½çš„JARæ–‡ä»¶
scp target/travel-diary-0.0.1-SNAPSHOT.jar username@server_ip:/home/username/
```

## 4. éƒ¨ç½²é…ç½®

### åˆ›å»ºé¡¹ç›®ç›®å½•
```bash
# åˆ›å»ºé¡¹ç›®ç›®å½•å’Œä¸Šä¼ ç›®å½•
mkdir -p /opt/traveldiary/uploads
cd /opt/traveldiary
```

### åˆ›å»ºé¡¹ç›®é…ç½®æ–‡ä»¶
```bash
# åˆ›å»ºç”Ÿäº§ç¯å¢ƒé…ç½®æ–‡ä»¶
vi /opt/traveldiary/application-prod.properties
```

é…ç½®æ–‡ä»¶å†…å®¹ï¼š
```properties
spring.application.name=demo
server.port=8081
server.servlet.context-path=/

# æ•°æ®åº“é…ç½®
spring.datasource.url=jdbc:mysql://localhost:3306/traveldiary?createDatabaseIfNotExist=true&useSSL=false&serverTimezone=UTC&allowPublicKeyRetrieval=true
spring.datasource.username=traveluser
spring.datasource.password=password123
spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver

# JPAé…ç½®
spring.jpa.hibernate.ddl-auto=update
spring.jpa.show-sql=false
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.MySQL8Dialect

# JWTé…ç½®
traveldiary.app.jwtSecret=ç”Ÿæˆä¸€ä¸ªå¤æ‚ä¸”å®‰å…¨çš„å¯†é’¥
traveldiary.app.jwtExpirationMs=86400000

# æ–‡ä»¶ä¸Šä¼ é…ç½®
spring.servlet.multipart.max-file-size=10MB
spring.servlet.multipart.max-request-size=10MB
file.upload-dir=/opt/traveldiary/uploads

# Jacksoné…ç½®
spring.jackson.serialization.FAIL_ON_EMPTY_BEANS=false

# é«˜å¾·åœ°å›¾APIé…ç½®
amap.api.key=a4e19c581e6a0571f787e6beb71fac45
amap.api.base-url=https://restapi.amap.com/v3
```

### å°†JARæ–‡ä»¶ç§»åŠ¨åˆ°é¡¹ç›®ç›®å½•
```bash
# å°†JARæ–‡ä»¶ç§»åŠ¨åˆ°é¡¹ç›®ç›®å½•
mv /home/username/travel-diary-0.0.1-SNAPSHOT.jar /opt/traveldiary/traveldiary.jar
```

## 5. ä½¿ç”¨Systemdç®¡ç†æœåŠ¡

### åˆ›å»ºæœåŠ¡é…ç½®æ–‡ä»¶
```bash
# åˆ›å»ºæœåŠ¡é…ç½®æ–‡ä»¶
sudo vi /etc/systemd/system/traveldiary.service
```

æœåŠ¡é…ç½®æ–‡ä»¶å†…å®¹ï¼š
```
[Unit]
Description=Travel Diary Application
After=syslog.target network.target mysql.service

[Service]
User=root
WorkingDirectory=/opt/traveldiary
ExecStart=/usr/bin/java -jar -Dspring.config.location=file:/opt/traveldiary/application-prod.properties /opt/traveldiary/traveldiary.jar
SuccessExitStatus=143
Restart=always
RestartSec=5

[Install]
WantedBy=multi-user.target
```

### å¯åŠ¨æœåŠ¡
```bash
# é‡æ–°åŠ è½½systemdé…ç½®
sudo systemctl daemon-reload

# å¯åŠ¨æœåŠ¡
sudo systemctl start traveldiary

# è®¾ç½®å¼€æœºè‡ªå¯
sudo systemctl enable traveldiary

# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
sudo systemctl status traveldiary
```

## 6. é…ç½®Nginxï¼ˆå¯é€‰ï¼Œæ¨èï¼‰

### å®‰è£…Nginx
```bash
# Ubuntu
sudo apt install nginx -y

# CentOS
sudo yum install nginx -y

# å¯åŠ¨Nginx
sudo systemctl start nginx
sudo systemctl enable nginx
```

### é…ç½®Nginxåå‘ä»£ç†
```bash
# åˆ›å»ºNginxé…ç½®æ–‡ä»¶
sudo vi /etc/nginx/conf.d/traveldiary.conf
```

é…ç½®æ–‡ä»¶å†…å®¹ï¼š
```
server {
    listen 80;
    server_name yourdomain.com;  # æ›¿æ¢ä¸ºä½ çš„åŸŸåæˆ–æœåŠ¡å™¨IP

    access_log /var/log/nginx/traveldiary_access.log;
    error_log /var/log/nginx/traveldiary_error.log;

    location / {
        proxy_pass http://localhost:8081;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    # é™æ€èµ„æºç¼“å­˜é…ç½®
    location ~* \.(jpg|jpeg|png|gif|ico|css|js)$ {
        proxy_pass http://localhost:8081;
        expires 30d;
        add_header Cache-Control "public, max-age=2592000";
    }

    # ä¸Šä¼ æ–‡ä»¶ç›®å½•é…ç½®
    location /uploads/ {
        alias /opt/traveldiary/uploads/;
        expires 30d;
        add_header Cache-Control "public, max-age=2592000";
    }
}
```

### é‡æ–°åŠ è½½Nginxé…ç½®
```bash
# æµ‹è¯•é…ç½®æ–‡ä»¶è¯­æ³•
sudo nginx -t

# é‡æ–°åŠ è½½é…ç½®
sudo systemctl reload nginx
```

## 7. é…ç½®HTTPSï¼ˆå¯é€‰ï¼Œä½†æ¨èï¼‰

### å®‰è£…Certbot
```bash
# Ubuntu
sudo apt install certbot python3-certbot-nginx -y

# CentOS
sudo yum install certbot python3-certbot-nginx -y
```

### è·å–SSLè¯ä¹¦å¹¶é…ç½®
```bash
sudo certbot --nginx -d yourdomain.com
```

## 8. é…ç½®é˜²ç«å¢™

```bash
# Ubuntu (UFW)
sudo ufw allow 22/tcp    # SSH
sudo ufw allow 80/tcp    # HTTP
sudo ufw allow 443/tcp   # HTTPS
sudo ufw enable

# CentOS (Firewalld)
sudo firewall-cmd --permanent --add-service=ssh
sudo firewall-cmd --permanent --add-service=http
sudo firewall-cmd --permanent --add-service=https
sudo firewall-cmd --reload
```

## 9. æµ‹è¯•éƒ¨ç½²

1. åœ¨æµè§ˆå™¨ä¸­è®¿é—®ï¼šhttp://yourdomain.com æˆ– http://server_ip
2. æ£€æŸ¥APIæ¥å£ï¼šhttp://yourdomain.com/api/diaries/all

## 10. æ—¥å¿—å’Œç›‘æ§

### æŸ¥çœ‹åº”ç”¨æ—¥å¿—
```bash
# æŸ¥çœ‹åº”ç”¨æ—¥å¿—
sudo journalctl -u traveldiary -f
```

### è®¾ç½®æ—¥å¿—è½®è½¬
```bash
# åˆ›å»ºæ—¥å¿—è½®è½¬é…ç½®
sudo vi /etc/logrotate.d/traveldiary
```

é…ç½®å†…å®¹ï¼š
```
/opt/traveldiary/logs/*.log {
    daily
    missingok
    rotate 14
    compress
    delaycompress
    notifempty
    create 0640 root root
}
```

## 11. å¤‡ä»½ç­–ç•¥

### æ•°æ®åº“å¤‡ä»½è„šæœ¬
```bash
# åˆ›å»ºå¤‡ä»½ç›®å½•
mkdir -p /opt/backups

# åˆ›å»ºå¤‡ä»½è„šæœ¬
vi /opt/backups/backup.sh
```

è„šæœ¬å†…å®¹ï¼š
```bash
#!/bin/bash
DATE=$(date +%Y%m%d)
BACKUP_DIR="/opt/backups"
DB_USER="traveluser"
DB_PASS="password123"
DB_NAME="traveldiary"

# å¤‡ä»½æ•°æ®åº“
mysqldump -u$DB_USER -p$DB_PASS $DB_NAME > $BACKUP_DIR/traveldiary_$DATE.sql

# å¤‡ä»½ä¸Šä¼ æ–‡ä»¶
tar -czf $BACKUP_DIR/uploads_$DATE.tar.gz /opt/traveldiary/uploads

# ä¿ç•™æœ€è¿‘30å¤©çš„å¤‡ä»½
find $BACKUP_DIR -name "traveldiary_*.sql" -mtime +30 -delete
find $BACKUP_DIR -name "uploads_*.tar.gz" -mtime +30 -delete
```

### è®¾ç½®å¤‡ä»½è®¡åˆ’ä»»åŠ¡
```bash
# è®¾ç½®è„šæœ¬æ‰§è¡Œæƒé™
chmod +x /opt/backups/backup.sh

# æ·»åŠ åˆ°crontab
crontab -e
```

æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š
```
0 2 * * * /opt/backups/backup.sh > /dev/null 2>&1
```

## 12. æ›´æ–°é¡¹ç›®åçš„é‡æ–°éƒ¨ç½²

```bash
# ä¸Šä¼ æ–°çš„JARåŒ…
scp target/travel-diary-0.0.1-SNAPSHOT.jar username@server_ip:/home/username/

# ç§»åŠ¨åˆ°é¡¹ç›®ç›®å½•
sudo mv /home/username/travel-diary-0.0.1-SNAPSHOT.jar /opt/traveldiary/traveldiary.jar

# é‡å¯æœåŠ¡
sudo systemctl restart traveldiary
```

## 13. æ›´æ–°READMEå’ŒAPIæ–‡æ¡£

å®Œæˆéƒ¨ç½²åï¼Œè¯·æ›´æ–°é¡¹ç›®çš„README.mdå’ŒAPI_DOCUMENT.mdæ–‡ä»¶ï¼Œæ·»åŠ äº‘æœåŠ¡å™¨è®¿é—®ä¿¡æ¯ï¼š

```markdown
## äº‘æœåŠ¡å™¨è®¿é—®ä¿¡æ¯

- è®¿é—®åœ°å€ï¼šhttp://yourdomain.com æˆ– http://server_ip
- APIåŸºç¡€URLï¼šhttp://yourdomain.com/api
- é»˜è®¤ç«¯å£ï¼š80ï¼ˆHTTPï¼‰/ 443ï¼ˆHTTPSï¼‰
```

éƒ¨ç½²å®Œæˆåï¼Œæ‚¨çš„æ—…è¡Œæ—¥è®°ç³»ç»Ÿå°±å¯ä»¥åœ¨äº‘æœåŠ¡å™¨ä¸Šæ­£å¸¸è¿è¡Œäº†ï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡æ‚¨é…ç½®çš„åŸŸåæˆ–æœåŠ¡å™¨IPåœ°å€è®¿é—®ç³»ç»Ÿã€‚

---

_**User**_

æœ‰æ²¡æœ‰å¿«é€Ÿéƒ¨ç½²çš„æŠ€æœ¯

---

_**Assistant**_

## æ—…è¡Œæ—¥è®°ç³»ç»Ÿå¿«é€Ÿéƒ¨ç½²æŠ€æœ¯

é’ˆå¯¹æ—…è¡Œæ—¥è®°ç³»ç»Ÿè¿™æ ·çš„Spring Bootåº”ç”¨ï¼Œæœ‰å¤šç§å¿«é€Ÿéƒ¨ç½²æŠ€æœ¯å¯ä»¥ç®€åŒ–éƒ¨ç½²æµç¨‹ï¼š

### 1. Dockerå®¹å™¨åŒ–éƒ¨ç½²
```bash
# åˆ›å»ºDockerfile
FROM openjdk:17-jdk-slim
WORKDIR /app
COPY target/travel-diary-0.0.1-SNAPSHOT.jar app.jar
COPY src/main/resources/application.properties application.properties
VOLUME /app/uploads
EXPOSE 8081
ENTRYPOINT ["java", "-jar", "app.jar"]
```

```bash
# æ„å»ºå’Œè¿è¡Œ
docker build -t traveldiary:latest .
docker run -d -p 8081:8081 --name traveldiary -v traveldiary-uploads:/app/uploads traveldiary
```

### 2. Docker Compose (æ•´åˆMySQL)
```yaml
version: '3'
services:
  mysql:
    image: mysql:8.0
    environment:
      MYSQL_DATABASE: traveldiary
      MYSQL_USER: traveluser
      MYSQL_PASSWORD: password123
      MYSQL_ROOT_PASSWORD: rootpassword
    volumes:
      - mysql-data:/var/lib/mysql
    restart: always
    
  traveldiary:
    build: .
    ports:
      - "8081:8081"
    depends_on:
      - mysql
    environment:
      SPRING_DATASOURCE_URL: jdbc:mysql://mysql:3306/traveldiary?createDatabaseIfNotExist=true
    volumes:
      - traveldiary-uploads:/app/uploads
    restart: always

volumes:
  mysql-data:
  traveldiary-uploads:
```

### 3. Kuberneteséƒ¨ç½²
ä½¿ç”¨Kubernetesç®¡ç†å®¹å™¨åŒ–åº”ç”¨ï¼Œæ”¯æŒè‡ªåŠ¨æ‰©å±•ã€è´Ÿè½½å‡è¡¡å’Œæ»šåŠ¨æ›´æ–°ã€‚

### 4. è‡ªåŠ¨åŒ–CI/CDæµæ°´çº¿
ä½¿ç”¨GitHub Actionsæˆ–Jenkinsè‡ªåŠ¨æ„å»ºã€æµ‹è¯•å’Œéƒ¨ç½²ï¼š
```yaml
name: Deploy to Server
on:
  push:
    branches: [ main ]
jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Set up JDK 17
        uses: actions/setup-java@v2
        with:
          java-version: '17'
          distribution: 'adopt'
      - name: Build with Maven
        run: mvn -B package --file pom.xml
      - name: Deploy to server
        uses: appleboy/scp-action@master
        with:
          host: ${{ secrets.HOST }}
          username: ${{ secrets.USERNAME }}
          key: ${{ secrets.SSH_KEY }}
          source: "target/travel-diary-0.0.1-SNAPSHOT.jar"
          target: "/opt/traveldiary/"
      - name: Restart service
        uses: appleboy/ssh-action@master
        with:
          host: ${{ secrets.HOST }}
          username: ${{ secrets.USERNAME }}
          key: ${{ secrets.SSH_KEY }}
          script: systemctl restart traveldiary
```

### 5. äº‘å¹³å°PaaSæœåŠ¡
- é˜¿é‡Œäº‘Webåº”ç”¨æ‰˜ç®¡æœåŠ¡
- è…¾è®¯äº‘Serverlessåº”ç”¨
- AWS Elastic Beanstalk
- Heroku

### 6. Spring Bootå¯æ‰§è¡ŒJARä¸€é”®éƒ¨ç½²
```bash
# æ‰“åŒ…
mvn clean package

# è¿è¡Œ
java -jar target/travel-diary-0.0.1-SNAPSHOT.jar --spring.profiles.active=prod
```

### 7. è‡ªåŠ¨åŒ–è„šæœ¬éƒ¨ç½²
```bash
#!/bin/bash
# deploy.sh
scp target/travel-diary-0.0.1-SNAPSHOT.jar user@server:/opt/traveldiary/
ssh user@server "systemctl restart traveldiary"
```

ä»¥ä¸Šæ–¹æ³•ä¸­ï¼ŒDockerå®¹å™¨åŒ–æ˜¯ç›®å‰æœ€æµè¡Œä¸”æœ€é«˜æ•ˆçš„å¿«é€Ÿéƒ¨ç½²æ–¹æ¡ˆï¼Œèƒ½ç¡®ä¿å¼€å‘å’Œç”Ÿäº§ç¯å¢ƒçš„ä¸€è‡´æ€§ï¼Œå¹¶ç®€åŒ–éƒ¨ç½²æµç¨‹ã€‚

---

_**User**_

è¯¦ç»†ä»‹ç»ä¸€ä¸‹docker

---

_**Assistant**_

# Dockerè¯¦ç»†ä»‹ç»

## DockeråŸºæœ¬æ¦‚å¿µ

Dockeræ˜¯ä¸€ä¸ªå¼€æºçš„å®¹å™¨åŒ–å¹³å°ï¼Œå®ƒä½¿ç”¨å®¹å™¨æ¥æ‰“åŒ…åº”ç”¨ç¨‹åºåŠå…¶ä¾èµ–ï¼Œå®ç°äº†åº”ç”¨ç¨‹åºçš„æ ‡å‡†åŒ–äº¤ä»˜ã€‚ä¸ä¼ ç»Ÿè™šæ‹Ÿæœºç›¸æ¯”ï¼ŒDockerå®¹å™¨æ›´è½»é‡ã€å¯åŠ¨æ›´å¿«ï¼Œå¹¶ä¸”èƒ½æ›´é«˜æ•ˆåœ°åˆ©ç”¨ç³»ç»Ÿèµ„æºã€‚

### æ ¸å¿ƒç»„ä»¶

1. **Dockerå¼•æ“**ï¼šDockerçš„æ ¸å¿ƒéƒ¨åˆ†ï¼Œè´Ÿè´£åˆ›å»ºå’Œç®¡ç†å®¹å™¨
2. **Dockeré•œåƒ**ï¼šå®¹å™¨çš„åªè¯»æ¨¡æ¿ï¼ŒåŒ…å«è¿è¡Œåº”ç”¨æ‰€éœ€çš„ä»£ç ã€è¿è¡Œæ—¶ã€åº“å’Œç¯å¢ƒå˜é‡
3. **Dockerå®¹å™¨**ï¼šé•œåƒçš„è¿è¡Œå®ä¾‹ï¼Œå¯ä»¥è¢«åˆ›å»ºã€å¯åŠ¨ã€åœæ­¢ã€åˆ é™¤å’Œæš‚åœ
4. **Dockerä»“åº“**ï¼šå­˜å‚¨å’Œåˆ†å‘Dockeré•œåƒçš„åœ°æ–¹ï¼Œå¦‚Docker Hub

## ä¸ºæ—…è¡Œæ—¥è®°ç³»ç»Ÿé…ç½®Docker

### 1. å®‰è£…Docker

```bash
# Ubuntu
sudo apt update
sudo apt install docker.io docker-compose -y
sudo systemctl enable --now docker

# CentOS
sudo yum install -y yum-utils
sudo yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo
sudo yum install docker-ce docker-ce-cli containerd.io docker-compose-plugin -y
sudo systemctl enable --now docker
```

### 2. åˆ›å»ºé¡¹ç›®Dockerfile

åœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»º`Dockerfile`æ–‡ä»¶ï¼š

```dockerfile
FROM openjdk:17-jdk-slim

# è®¾ç½®å·¥ä½œç›®å½•
WORKDIR /app

# å¤åˆ¶JARæ–‡ä»¶å’Œé…ç½®
COPY target/travel-diary-0.0.1-SNAPSHOT.jar app.jar
COPY src/main/resources/application.properties /app/

# åˆ›å»ºä¸Šä¼ ç›®å½•
RUN mkdir -p /app/uploads

# è®¾ç½®æ—¶åŒº
ENV TZ=Asia/Shanghai

# æš´éœ²ç«¯å£
EXPOSE 8081

# å¯åŠ¨å‘½ä»¤
ENTRYPOINT ["java", "-jar", "-Dspring.config.location=file:/app/application.properties", "app.jar"]
```

### 3. åˆ›å»ºDocker Composeé…ç½®

åˆ›å»º`docker-compose.yml`æ–‡ä»¶ï¼Œé›†æˆMySQLå’Œåº”ç”¨æœåŠ¡ï¼š

```yaml
version: '3.8'

services:
  # MySQLæ•°æ®åº“æœåŠ¡
  mysql:
    image: mysql:8.0
    container_name: traveldiary-mysql
    restart: always
    environment:
      MYSQL_DATABASE: traveldiary
      MYSQL_USER: traveluser
      MYSQL_PASSWORD: password123
      MYSQL_ROOT_PASSWORD: rootpassword
    volumes:
      - mysql-data:/var/lib/mysql
      - ./src/main/resources/db-init.sql:/docker-entrypoint-initdb.d/init.sql
    ports:
      - "3306:3306"
    networks:
      - traveldiary-network
    healthcheck:
      test: ["CMD", "mysqladmin", "ping", "-h", "localhost", "-u", "root", "-p$$MYSQL_ROOT_PASSWORD"]
      interval: 10s
      timeout: 5s
      retries: 5

  # åº”ç”¨æœåŠ¡
  traveldiary-app:
    build: .
    container_name: traveldiary-app
    restart: always
    depends_on:
      mysql:
        condition: service_healthy
    environment:
      # æ•°æ®åº“è¿æ¥é…ç½®
      SPRING_DATASOURCE_URL: jdbc:mysql://mysql:3306/traveldiary?createDatabaseIfNotExist=true&useSSL=false&serverTimezone=Asia/Shanghai&allowPublicKeyRetrieval=true
      SPRING_DATASOURCE_USERNAME: traveluser
      SPRING_DATASOURCE_PASSWORD: password123
      # JWTé…ç½®ï¼ˆä½¿ç”¨ç¯å¢ƒå˜é‡å¢å¼ºå®‰å…¨æ€§ï¼‰
      TRAVELDIARY_APP_JWTSECRET: ${JWT_SECRET:-travelDiarySecretKey123456789012345678901234567890}
      # æ–‡ä»¶ä¸Šä¼ è·¯å¾„
      FILE_UPLOAD_DIR: /app/uploads
    volumes:
      - traveldiary-uploads:/app/uploads
    ports:
      - "8081:8081"
    networks:
      - traveldiary-network

# å®šä¹‰ç½‘ç»œ
networks:
  traveldiary-network:
    driver: bridge

# å®šä¹‰æ•°æ®å·
volumes:
  mysql-data:
  traveldiary-uploads:
```

### 4. ä¿®æ”¹åº”ç”¨é…ç½®ä»¥æ”¯æŒDockerç¯å¢ƒ

ä¿®æ”¹`application.properties`æ–‡ä»¶ï¼Œæ·»åŠ å¯¹Dockerç¯å¢ƒçš„æ”¯æŒï¼š

```properties
# åº”ç”¨é…ç½®
spring.application.name=traveldiary
server.port=8081
server.servlet.context-path=/

# æ•°æ®åº“é…ç½®ï¼ˆæ”¯æŒç¯å¢ƒå˜é‡è¦†ç›–ï¼‰
spring.datasource.url=${SPRING_DATASOURCE_URL:jdbc:mysql://localhost:3306/traveldiary?createDatabaseIfNotExist=true&useSSL=false&serverTimezone=UTC&allowPublicKeyRetrieval=true}
spring.datasource.username=${SPRING_DATASOURCE_USERNAME:traveluser}
spring.datasource.password=${SPRING_DATASOURCE_PASSWORD:password123}
spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver

# JPAé…ç½®
spring.jpa.hibernate.ddl-auto=update
spring.jpa.show-sql=false
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.MySQL8Dialect

# JWTé…ç½®ï¼ˆæ”¯æŒç¯å¢ƒå˜é‡è¦†ç›–ï¼‰
traveldiary.app.jwtSecret=${TRAVELDIARY_APP_JWTSECRET:travelDiarySecretKey123456789012345678901234567890}
traveldiary.app.jwtExpirationMs=86400000

# æ–‡ä»¶ä¸Šä¼ é…ç½®ï¼ˆæ”¯æŒç¯å¢ƒå˜é‡è¦†ç›–ï¼‰
spring.servlet.multipart.max-file-size=10MB
spring.servlet.multipart.max-request-size=10MB
file.upload-dir=${FILE_UPLOAD_DIR:./uploads}

# Jacksoné…ç½®
spring.jackson.serialization.FAIL_ON_EMPTY_BEANS=false

# é«˜å¾·åœ°å›¾APIé…ç½®
amap.api.key=${AMAP_API_KEY:a4e19c581e6a0571f787e6beb71fac45}
amap.api.base-url=https://restapi.amap.com/v3
```

### 5. æ„å»ºå’Œéƒ¨ç½²

```bash
# æ„å»ºé¡¹ç›®
mvn clean package -DskipTests

# å¯åŠ¨Dockerå®¹å™¨
docker-compose up -d

# æŸ¥çœ‹è¿è¡ŒçŠ¶æ€
docker-compose ps

# æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f
```

## Dockerçš„é«˜çº§ç‰¹æ€§ä¸ä¼˜åŠ¿

### 1. èµ„æºéš”ç¦»ä¸é™åˆ¶

å¯ä»¥é™åˆ¶å®¹å™¨ä½¿ç”¨çš„CPUå’Œå†…å­˜èµ„æºï¼š

```yaml
services:
  traveldiary-app:
    # å…¶ä»–é…ç½®...
    deploy:
      resources:
        limits:
          cpus: '0.5'
          memory: 512M
        reservations:
          cpus: '0.25'
          memory: 256M
```

### 2. å®¹å™¨ç¼–æ’ä¸æ‰©å±•

ä½¿ç”¨Docker Swarmæˆ–Kuberneteså®ç°å¤šå®¹å™¨ç¼–æ’ï¼Œæ”¯æŒï¼š
- è‡ªåŠ¨è´Ÿè½½å‡è¡¡
- æœåŠ¡å‘ç°
- æ»šåŠ¨æ›´æ–°
- è‡ªåŠ¨æ‰©ç¼©å®¹

### 3. æ•°æ®æŒä¹…åŒ–

Dockeræä¾›å¤šç§æ•°æ®æŒä¹…åŒ–æ–¹æ¡ˆï¼š
- **Volumes**ï¼šDockerç®¡ç†çš„æŒä¹…åŒ–å­˜å‚¨ï¼Œä¸å®¹å™¨ç”Ÿå‘½å‘¨æœŸç‹¬ç«‹
- **Bind Mounts**ï¼šå°†ä¸»æœºæ–‡ä»¶ç³»ç»ŸæŒ‚è½½åˆ°å®¹å™¨
- **tmpfs Mounts**ï¼šä¸´æ—¶æ–‡ä»¶ç³»ç»Ÿï¼Œå­˜å‚¨åœ¨å†…å­˜ä¸­

### 4. ç½‘ç»œæ¨¡å‹

Dockeræ”¯æŒå¤šç§ç½‘ç»œé©±åŠ¨ï¼š
- **bridge**ï¼šé»˜è®¤ç½‘ç»œï¼Œå®¹å™¨é—´å¯é€šè¿‡IPé€šä¿¡
- **host**ï¼šå®¹å™¨å…±äº«ä¸»æœºç½‘ç»œæ ˆ
- **overlay**ï¼šæ”¯æŒè·¨ä¸»æœºå®¹å™¨é€šä¿¡
- **macvlan**ï¼šåˆ†é…MACåœ°å€ç»™å®¹å™¨

### 5. å¤šé˜¶æ®µæ„å»º

ä¼˜åŒ–é•œåƒå¤§å°å’Œæ„å»ºè¿‡ç¨‹ï¼š

```dockerfile
# æ„å»ºé˜¶æ®µ
FROM maven:3.8.6-openjdk-17-slim AS build
WORKDIR /app
COPY pom.xml .
COPY src ./src
RUN mvn clean package -DskipTests

# è¿è¡Œé˜¶æ®µ
FROM openjdk:17-jdk-slim
WORKDIR /app
COPY --from=build /app/target/travel-diary-0.0.1-SNAPSHOT.jar app.jar
EXPOSE 8081
ENTRYPOINT ["java", "-jar", "app.jar"]
```

## Dockerå®‰å…¨æœ€ä½³å®è·µ

1. **ä½¿ç”¨érootç”¨æˆ·è¿è¡Œå®¹å™¨**ï¼š
   ```dockerfile
   RUN groupadd -r appuser && useradd -r -g appuser appuser
   USER appuser
   ```

2. **å®šæœŸæ›´æ–°åŸºç¡€é•œåƒ**ï¼Œä¿®å¤å®‰å…¨æ¼æ´
3. **é™åˆ¶å®¹å™¨çš„ç³»ç»Ÿè°ƒç”¨**ï¼Œä½¿ç”¨seccompå’ŒAppArmor
4. **ä½¿ç”¨ç§æœ‰ä»“åº“**å­˜å‚¨æ•æ„Ÿé•œåƒ
5. **æ‰«æé•œåƒæ¼æ´**ï¼Œä½¿ç”¨å·¥å…·å¦‚Trivyæˆ–Clair

## äº‘å¹³å°Dockeré›†æˆ

ä¸»æµäº‘å¹³å°éƒ½æä¾›Dockerå®¹å™¨æœåŠ¡ï¼š

1. **é˜¿é‡Œäº‘**ï¼šå®¹å™¨æœåŠ¡Kubernetesç‰ˆ(ACK)
2. **è…¾è®¯äº‘**ï¼šå®¹å™¨æœåŠ¡TKE
3. **åä¸ºäº‘**ï¼šäº‘å®¹å™¨å¼•æ“CCE
4. **AWS**ï¼šElastic Container Service(ECS)å’ŒElastic Kubernetes Service(EKS)
5. **Azure**ï¼šAzure Container Instanceså’ŒAzure Kubernetes Service

## ç›‘æ§å’Œæ—¥å¿—ç®¡ç†

1. **å®¹å™¨ç›‘æ§**ï¼šPrometheus + Grafana
2. **æ—¥å¿—æ”¶é›†**ï¼šELK Stack (Elasticsearch, Logstash, Kibana) æˆ– Graylog
3. **å®¹å™¨å¯è§†åŒ–ç®¡ç†**ï¼šPortainer

## æ—…è¡Œæ—¥è®°ç³»ç»Ÿçš„Dockeréƒ¨ç½²æµç¨‹æ€»ç»“

1. **å‡†å¤‡å·¥ä½œ**ï¼šå®‰è£…Dockerå’ŒDocker Compose
2. **é¡¹ç›®é…ç½®**ï¼šåˆ›å»ºDockerfileå’Œdocker-compose.yml
3. **åº”ç”¨é€‚é…**ï¼šä¿®æ”¹é…ç½®æ”¯æŒç¯å¢ƒå˜é‡
4. **æ„å»ºé•œåƒ**ï¼šæ„å»ºDockeré•œåƒ
5. **å¯åŠ¨æœåŠ¡**ï¼šä½¿ç”¨docker-composeå¯åŠ¨æ‰€æœ‰æœåŠ¡
6. **ç®¡ç†ä¸ç›‘æ§**ï¼šç®¡ç†å®¹å™¨ã€é…ç½®ç›‘æ§å’Œæ—¥å¿—æ”¶é›†

ä½¿ç”¨Dockeréƒ¨ç½²æ—…è¡Œæ—¥è®°ç³»ç»Ÿï¼Œå¯ä»¥æ˜¾è‘—ç®€åŒ–éƒ¨ç½²æµç¨‹ï¼Œæé«˜ç³»ç»Ÿå¯ç§»æ¤æ€§ï¼Œå¹¶ä½¿ç³»ç»Ÿæ›´æ˜“äºæ‰©å±•å’Œç»´æŠ¤ã€‚

---

_**User**_

è¿™äº›æ“ä½œå…¨éƒ¨éƒ½æ˜¯åº”ç”¨åœ¨æœåŠ¡å™¨ä¸Šçš„å—ï¼Ÿ

---

_**Assistant**_

# Dockeræ“ä½œç¯å¢ƒè¯´æ˜

Dockerç›¸å…³æ“ä½œå¯ä»¥åœ¨ä¸åŒç¯å¢ƒä¸­æ‰§è¡Œï¼Œå…·ä½“å–å†³äºæ‚¨çš„éƒ¨ç½²æµç¨‹å’Œå·¥ä½œæ–¹å¼ï¼š

## æœ¬åœ°å¼€å‘ç¯å¢ƒæ“ä½œ

ä»¥ä¸‹æ“ä½œé€šå¸¸åœ¨æœ¬åœ°å¼€å‘ç¯å¢ƒä¸­è¿›è¡Œï¼š

---

